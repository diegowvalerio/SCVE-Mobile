package net.ddns.scvemarchezanmetais.scvemobile.activitys;

import android.content.Intent;
import android.content.SharedPreferences;
import android.preference.PreferenceManager;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.EditText;
import android.widget.ListView;
import android.widget.Toast;

import net.ddns.scvemarchezanmetais.scvemobile.R;
import net.ddns.scvemarchezanmetais.scvemobile.banco.DatabaseHelper;
import net.ddns.scvemarchezanmetais.scvemobile.dao.DAOItem;
import net.ddns.scvemarchezanmetais.scvemobile.dao.DAOMovimento;
import net.ddns.scvemarchezanmetais.scvemobile.dao.DAOTipoMv;
import net.ddns.scvemarchezanmetais.scvemobile.entidades.Item;
import net.ddns.scvemarchezanmetais.scvemobile.entidades.Movimento;

import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

public class Novo_Pedido extends AppCompatActivity {
    EditText dtvenda,observacao,totalvenda,cliente,tipoMv,condPagto,formaPag;
    String formato = "dd/MM/yyyy";

    DatabaseHelper dh;

    Movimento movimento = new Movimento();
    DAOMovimento daoMovimento;
    DAOItem daoItem;

    DAOTipoMv daoTipoMv;

    List<Item> items = new ArrayList<>();

    ListView listViewProdutos;

    int V =0;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_novo__pedido);

        dh = new DatabaseHelper(this);
        try {
            daoMovimento = new DAOMovimento(dh.getConnectionSource());
            daoItem = new DAOItem(dh.getConnectionSource());
            daoTipoMv = new DAOTipoMv(dh.getConnectionSource());
        }catch (SQLException e){
            e.printStackTrace();
        }

        tipoMv = findViewById(R.id.ptitpomv);
        tipoMv.setFocusable(false);
        condPagto = findViewById(R.id.pprazo);
        condPagto.setFocusable(false);
        formaPag = findViewById(R.id.pformapagto);
        formaPag.setFocusable(false);
        cliente = findViewById(R.id.pcliente);
        cliente.setFocusable(false);
        /*
        dtvenda = findViewById(R.id.dtvenda);
        observacao = findViewById(R.id.obersavao);
        totalvenda = findViewById(R.id.totalvenda);
        */
        listViewProdutos = (ListView) findViewById(R.id.listviewProdutos);

    }

    public void tipopedido(View view){
        Intent intent = new Intent(this,Novo_Pedido_TipodePedido.class);
        startActivity(intent);
        V = 1;
    }

    @Override
    protected void onStart() {
        super.onStart();
        buscatipopedido();
    }

    private void buscatipopedido() {
        SharedPreferences lt = PreferenceManager.getDefaultSharedPreferences(getApplicationContext()); //this.getPreferences(Context.MODE_PRIVATE);
        SharedPreferences.Editor editor = lt.edit();
        String t = lt.getString("idtipopedido","vazio");

        if(V==1) {
            if (!t.equals("vazio")) {
                try {
                    movimento.setTipoMv(daoTipoMv.queryForId(Integer.parseInt(t)));
                    tipoMv.setText(movimento.getTipoMv().getNome().toString());
                    //Toast.makeText(this, ""+t, Toast.LENGTH_SHORT).show();
                    //condPagto.requestFocus();
               } catch (SQLException e) {
                   e.printStackTrace();
                }
            } else {
                Toast.makeText(this, "Tipo de Pedido Informada inv√°lida", Toast.LENGTH_SHORT).show();
            }
        }
    }
}
